flowchart LR

%% Each phase is one line of code to promote small batches
%% Two lines of code means smaller batches called for

    Y[Start]-->A[/master branch\]

    subgraph build-phase
    A[/master branch\]-->AB[/master branch\]

    %% Begin top line build phase
    AB[/master branch\]--regression tests-->B[/master branch\]

    %% Feature branch is forked from master
    A[/master branch\]-.create feature flag.->C[/feature branch\]

    %% Feature developement begins behind flag
    subgraph feature-flag
    C[/feature branch\]-.write regression tests .->D[/feature branch\]
    D[/feature branch\]
    end feature-flag
    end build-phase

    subgraph release-phase
    B[/master branch\]--regression tests-->E[/new master branch\]

    %% Work is integrated
    D[/feature branch\]-.combine tests .->E[/new master branch\]
    end release-phase

    %% Post-experiment cleanup phase
    subgraph cleanup-phase
    D[/feature branch\]-.->F[/feature branch\]
    F[/feature branch\]
    end cleanup-phase

    F[/feature branch\]-.delete feature flag.->Z[End]

    style F fill:#000,stroke:#f00,stroke-width:4px,color:#f00,stroke-dasharray: 5 5