flowchart LR

    Z[Start]-->A[/master branch\]

    subgraph build-phase
    A[/master branch\]-->H[/master branch\]

    %% Begin top line build phase
    H[/master branch\]--regression tests-->B[/master branch\]--regression tests-->E[/new master branch\]

    %% Feature branch is forked from master
    A[/master branch\]-.->C[/feature branch\]

    %% Feature developement begins behind flag
    subgraph feature-flag
    C[/feature branch\]-.write regression tests .->D[/feature branch\]
    D[/feature branch\]
    end feature-flag
    end build-phase

    %% Work is integrated
    D[/feature branch\]-.combine tests .->E[/new master branch\]

    %% Post-experiment cleanup phase
    subgraph cleanup-phase
    D[/feature branch\]-->F[/feature branch\]
    end cleanup-phase

    style F fill:#000,stroke:#f00,stroke-width:4px,color:#f00,stroke-dasharray: 5 5